<app-header></app-header>
<app-sidebar></app-sidebar>
<div class="content-wrapper">
    <app-breadcrumbs></app-breadcrumbs>
    <!-- <div class="container">
        <h1>Lista de Usuarios</h1>
        <button type="button" class="btn btn-success" (click)="nuevoUsuario()">Crear Nuevo</button>
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th scope="col">ID</th>
              <th scope="col">USUARIO</th>
              <th scope="col">Codigo del usuario</th>
              <th scope="col">Estado</th>
              <th scope="col">rol</th>
              <th scope="col">FECHA de creacion</th>
              <th scope="col">EDITAR</th>
              <th scope="col">ELIMINAR</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of usuarios" >
              <th scope="row">{{ user.ID }}</th>
              <td>{{ user.usuario }}</td>
              <td>{{ user.codusuario }}</td>
              <td>{{ user.estado }}</td>
              <td>{{ user.rol }}</td>
              <td>{{ user.fechacreacion }}</td>
              <td> <button type="button" class="btn btn-primary" (click)="editarUsuario(user.ID)">Editar</button> </td>
              <td><button type="button" class="btn btn-danger" (click)="eliminarUsuario(user.ID)">Eliminar</button></td>
            </tr>
          </tbody>
        </table>
        
      </div> -->


    <!-- Modal agregar -->
    <div class="modal fade" id="hola" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">Crear Mi Usuario</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <!-- Formulario -->
            <!-- Formulario en el modal -->
            <form [formGroup]="nuevoForm" (ngSubmit)="postForm(nuevoForm.value)">
              <div class="row">
                <div class="col">
                    <label for="codusuario" class="form-label">Código de Usuario</label>
                    <input type="text" class="form-control" formControlName="codusuario" required>
                    <div *ngIf="codusuario?.invalid && (codusuario?.dirty || codusuario?.touched)">
                      <div *ngIf="codusuario?.errors?.['required']" class="text-danger">El codigo del usuario es requerido.</div>
                      <div *ngIf="codusuario?.errors?.['pattern']" class="text-danger">El codigo del usuario solo puede contener numeros.</div>
                      <div *ngIf="codusuario?.errors?.['minlength']" class="text-danger">El codigo del usuario debe tener al menos 6 caracteres.</div>
                      <div *ngIf="codusuario?.errors?.['maxlength']" class="text-danger">El codigo del usuario no puede tener más de 6 caracteres.</div>
                    </div>
                </div>

                <div class="col">
                    <label for="usuario" class="form-label">Usuario (@gamil.com)</label>
                    <input type="email" class="form-control" formControlName="usuario" required>
                    <div *ngIf="nuevoForm.get('usuario')?.invalid && (nuevoForm.get('usuario')?.dirty || nuevoForm.get('usuario')?.touched)">
                      <div *ngIf="nuevoForm.get('usuario')?.errors?.['required']" class="text-danger">El usuario es requerido, solo puede @gmail.com.</div>
                    </div>
                </div>
              </div>

              <div class="row">
                  <div class="col">
                      <label for="nombreusuario" class="form-label">Nombre y Apellido</label>
                      <input type="text" class="form-control" formControlName="nombreusuario" required>
                      <div *ngIf="nuevoForm.get('nombreusuario')?.invalid && (nuevoForm.get('nombreusuario')?.dirty || nuevoForm.get('nombreusuario')?.touched)">
                        <div *ngIf="nuevoForm.get('nombreusuario')?.errors?.['required']" class="text-danger">El nombre y apellido es requerido.</div>
                        <div *ngIf="nuevoForm.get('nombreusuario')?.errors?.['pattern']" class="text-danger">El nombre y apellid solo puede contener letras y espacios.</div>
                      </div>
                  </div>

                  <div class="col">
                      <label for="contrasena" class="form-label">Contraseña</label>
                      <input type="password" class="form-control" formControlName="contrasena" required>
                      <div *ngIf="nuevoForm.get('contrasena')?.invalid && (nuevoForm.get('contrasena')?.dirty || nuevoForm.get('contrasena')?.touched)">
                        <div *ngIf="nuevoForm.get('contrasena')?.errors?.['required']" class="text-danger">El contrasena es requerido.</div>
                      </div>
                  </div>
              </div>

              <div class="row">
                  <div class="col">
                      <label for="estado" class="form-label">Estado</label>
                      <select class="form-control"  formControlName="estado" required>
                          <option value="Activo">Activo</option>
                          <option value="Inactivo">Inactivo</option>
                      </select>
                      <div *ngIf="nuevoForm.get('estado')?.invalid && (nuevoForm.get('estado')?.dirty || nuevoForm.get('estado')?.touched)">
                        <div *ngIf="nuevoForm.get('estado')?.errors?.['required']" class="text-danger">El estado es requerido.</div>
                      </div>
                  </div>

                  <div class="col">
                      <label for="nivel" class="form-label">Nivel</label>
                      <select class="form-control"  formControlName="nivel" required>
                          <option value="Decano">Decano</option>
                          <option value="Director">Director</option>
                          <option value="Secretaria">Secretaria</option>
                      </select>
                      <div *ngIf="nuevoForm.get('nivel')?.invalid && (nuevoForm.get('nivel')?.dirty || nuevoForm.get('nivel')?.touched)">
                        <div *ngIf="nuevoForm.get('nivel')?.errors?.['required']" class="text-danger">El nivel es requerido.</div>
                      </div>
                  </div>
              </div>
                
              <div class="row">
                  <div class="col">
                      <label for="rol" class="form-label">Rol</label>
                      <select class="form-control" formControlName="rol" required>
                          <option value="Administrador">Administrador</option> 
                          <option value="Visualizador">Visualizador</option> 
                          <option value="Usuario">Usuario</option> 
                          <option value="AgregarMas">AgregarMas</option>
                      </select>
                      <div *ngIf="nuevoForm.get('rol')?.invalid && (nuevoForm.get('rol')?.dirty || nuevoForm.get('rol')?.touched)">
                        <div *ngIf="nuevoForm.get('rol')?.errors?.['required']" class="text-danger">El rol es requerido.</div>
                      </div>
                  </div>

                  <div class="col">
                      <label for="fechacreacion" class="form-label">Fecha de Creación</label>
                      <input type="date" class="form-control" formControlName="fechacreacion" required>
                      <div *ngIf="nuevoForm.get('fechacreacion')?.['invalid'] && (nuevoForm.get('fechacreacion')?.['dirty'] || nuevoForm.get('fechacreacion')?.['touched'])">
                        <div *ngIf="nuevoForm.get('fechacreacion')?.errors?.['required']" class="text-danger">La fecha es requerida.</div>
                      </div>
                  </div>
              </div>

              <div class="text-center">
                <div class="row">
                  <div class="col btn">
                    <button type="submit" data-bs-dismiss="modal" class="btn btn-success" [disabled]="nuevoForm.invalid">Guardar</button>
                  </div>
                  <div class="col btn">
                    <button type="button" class="btn btn-warning"  data-bs-dismiss="modal">Cerrar</button>
                  </div>
                </div>
              </div>
            </form>
            <!-- Fin del formulario -->
          </div>
        </div>
      </div>
    </div> 
    <!-- fin modal agregar -->

    <!-- Tabla -->
      <div class="container mat-elevation-z8 mat-table-responsive">
          <!-- Botón para abrir el modal -->
          <button type="button" class="btn btn-success" (click)="limpiarFormulario()"data-bs-toggle="modal" data-bs-target="#hola">
            <i class="nav-icon fas fa-plus-circle"></i>
          </button> 
           
        <mat-form-field>
          <input matInput (keyup)="handleKeyup($event)" placeholder="Buscar">
        </mat-form-field>
        
        <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" matSort>
          
          <!-- Define las columnas aquí usando *ngFor -->
          <ng-container *ngFor="let column of displayedColumns" [matColumnDef]="column">
            <mat-header-cell *matHeaderCellDef mat-sort-header>{{ getColumnHeader(column) }}</mat-header-cell>
            <mat-cell *matCellDef="let usuarios">{{ usuarios[column] }}</mat-cell>
          </ng-container>
  
          
        
          <ng-container matColumnDef="acciones">
            <mat-header-cell mat-header-cell *matHeaderCellDef>Acciones</mat-header-cell>
            <mat-cell mat-cell *matCellDef="let usuarios">
              <button class="mano-cursor btn btn-primary" mat-icon-button data-bs-toggle="modal" data-bs-target="#editar" (click)="getUser(usuarios.ID)">
                <i class="nav-icon fas fa-edit"></i>
              </button>
              <button class="mano-cursor btn btn-danger" mat-icon-button (click)="eliminarUsuario(usuarios.ID)">
                <i class="nav-icon fas fa-trash-alt"></i>
              </button>
              
            </mat-cell>
          </ng-container>
          
  
          
          <!-- Define los encabezados de fila -->
          <mat-header-row *matHeaderRowDef="displayedColumns.concat('acciones')"></mat-header-row>
          <mat-row *matRowDef="let row; columns: displayedColumns.concat('acciones');"></mat-row>
  
          <!-- Define las filas de datos -->
          <!-- <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row> -->
        </table>
        
        <!-- <mat-paginator [pageSizeOptions]="[3, 10, 25]" showFirstLastButtons></mat-paginator> -->
        <mat-paginator [pageSizeOptions]="[5, 15, 25]" showFirstLastButtons></mat-paginator>
  
        
      </div>
    <!-- Fin de la tabla -->
    
    <!-- modal editar -->
        <div class="modal fade" id="editar" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h2 class="modal-title" id="staticBackdropLabel">EDITAR USUARIO</h2>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div> 
              
              <div class="modal-body">
                <form [formGroup]="editarForm" (ngSubmit)="putForm(editarForm.value)"> 
                  <div class="row">
                    <div class="col">
                      <label for="codigo" class="form-label">Código del usuario</label>
                      <input type="text" class="form-control" formControlName="codusuario">
                    </div>
  
                    <div class="col">
                      <label for="usuario" class="form-label">Usuario</label>
                      <input type="text" class="form-control" formControlName="usuario">
                    </div>
                  </div>
                  
                  <div class="row">  
                    <div class="col">
                      <label for="usuario" class="form-label">Nombre del Usuario</label>
                      <input type="text" class="form-control" formControlName="nombreusuario">
                    </div>      
  
                    <div class="col">
                      <label for="nuevacontrasena" class="form-label">Nueva contraseña</label>
                       <input type="text" class="form-control" formControlName="nuevacontrasena">
                    </div>                
                  </div>
  
                  <div class="row">
                    <div class="col">
                        <label for="estado" class="form-label">Estado</label>
                        <select class="form-select" formControlName="estado">
                            <option value="Activo">Activo</option> 
                            <option value="Inactivo">Inactivo</option> 
                        </select>
                    </div>
  
                    <div class="col">
                        <label for="nivel" class="form-label">Nivel</label>
                        <select class="form-select" formControlName="nivel">
                            <option value="Decano">Decano</option> 
                            <option value="Director">Director</option> 
                            <option value="Secretario">Secretario</option> 
                        </select>
                    </div>
                  </div>
  
                  <div class="row">
                    <div class="col">
                          <label for="rol" class="form-label">rol</label>
                          <select class="form-select" formControlName="rol">
                            <option value="Administrador">Administrador</option> 
                            <option value="Visualizador">Visualizador</option> 
                            <option value="Usuario">Usuario</option> 
                            <option value="AgregarMas">AgregarMas</option> 
                          </select>
                    </div>
  
                    <div class="col">
                        <label for="fechacreacion" class="form-label">Fecha de creación</label>
                        <input type="date" class="form-control" formControlName="fechacreacion">
                    </div>
                  </div>

                  <div class="text-center">
                    <div class="row">
                      <div class="col btn">
                        <button type="submit" class="btn btn-primary" data-bs-dismiss="modal">Guardar</button>
                      </div>
                      
                      <div class="col btn">
                        <button type="button" class="btn btn-warning" data-bs-dismiss="modal">Cerrar</button>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div> 

</div>
<app-footer></app-footer>